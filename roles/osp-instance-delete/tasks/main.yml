---
# tasks file for roles/osp-instance-delete
- name: Fetch Instance Info
  os_server_facts:
    cloud: ospcloud
  register: openstack_servers
  tags:
    - cleanup

- name: Print records  
  debug:
    var: item.0.name
  with_items: 
    - "{{ openstack_servers}}"
  tags:
    - cleanup

- name: Delete instances
  os_server:
    cloud: ospcloud
    name: "{{ item.0.name }}"
    state: absent
    image: rhel-guest
    flavor: m2.small
    delete_fip: true
  with_items: 
    - "{{ openstack_servers}}"
  tags:
    - cleanup
